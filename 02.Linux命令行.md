# Linux Command Line

## 1.Shell

Shell 接受键盘输入的命令，将其传入到 OS 中执行。一般提到的命令行就是 Shell，Linux 发行版提供了来自 GNU 项目的 Shell 程序 Bash。Bash 是 sh(UNIX Shell) 的增强版。

### 1.1目录解读

- `/usr/share/doc`: 系统中安装的软件的文档文件。

![11](img/11.jpg)

![12](img/12.jpg)

![13](img/13.jpg)

### 1.2概述

提示符：`#` 表示具有超级用户 (root) 权限，一般情况下为 `$`。

查看磁盘当前可用空间：`df`

查看内存容量：`free`

终止终端：`exit` 或 `ctrl+d`

#### 文件树

在类 UNIX 系统中，只有一个文件系统树，按照设置，存储设备会**挂载**在文件系统树的不同位置。

**pwd:** 显示当前目录，即 print working directory，每个普通用户都有自己的主目录，该**主目录也是普通用户唯一有权限写入文件的地方。**

**ls:** 列出当前工作目录中的文件和子目录

```bash
ls --help
# 使用长格式命令
ls -l 
ls -lt --reverse
```

![](img/09.jpg)

**cd:**  更改当前目录，如更改到程序安装的目录中：`cd /usr/bin`。`.` 表示当前目录，`..` 表示上一级目录，

大多数情况下，可以忽略 `./` 。

一些便捷写法：

![](img/08.jpg)

**文件名说明**

在 Linux 中万物皆文件 (Everything is a file)，不要求文件名必须反映文件内容，如 `.jpg` 文件未必就是图像。

- 以 `.` 开头的文件是隐藏的，使用 `ls -a` 才可以查看
- 建议使用下划线 `_` 而不是空格，避免不必要的麻烦
- 没有文件拓展名，即不根据文件拓展名决定文件的内容和用途

#### 选项和参数

```bash
command -option arguments
```

单个连字符：短选项，可合并在一起使用

两个连字符：长选项

**文件字段解读**

10 个字符，第一个指明文件的类型，其余皆表明相应的文件访问权限。

![](img/10.jpg)

**file:** 确定文件类型，输出对文件的简要描述。

**less:** 使用 less 命令查看文本文件，`less \etc\passwd`

#### 符号链接和硬链接

符号链接也称作软链接。

![](img/14.jpg)

### 1.3操作文件和目录

#### 常用命令

- mkdir：创建目录
- cp：复制文件和目录
- mv：移动和重命名文件和目录
- rm：删除文件和目录
- ln：创建符号链接和硬链接

#### 通配符

通配符 (wildcard)：用于帮助快速指定一组文件名的一种特殊字符。

使用通配符的过程称为，通配符匹配 (globbing)。

`[A-Z]` 或 `[a-z]` 属于传统的写法，现在使用字符类代替这种写法。

匹配隐藏文件：`.[!.]*`

![](img/15.jpg)

![16](img/16.jpg)

![17](img/17.jpg)

#### 详解介绍

**mkdir**

```bash
mkdir dir1, dir2, dir3
```

**cp**

与 mv 的用法类似，未指明选项的，会默认覆盖同名文件。

![](img/18.jpg)

![](img/19.jpg)

```bash
# 将 item1 复制到 item2
cp item1 item2
```

**mv**

![](img/20.jpg)

![21](img/21.jpg)

**rm**

删除一个或多个文件和目录

`rm -r directory`: 删除文件夹

![](img/22.jpg)

**ln**

创建硬链接和符号链接。

```bash
#硬链接，不能为目录创建
ln file link
#符号链接，文件或目录
ln -s item link
```

**硬链接**：默认情况每个文件只有一个，存在两个重要限制：

- 不能引用目录
- 文件与链接不在同一磁盘分区则无法引用该文件

![](img/23.jpg)

**4** 表示当前的硬链接数量，**文件至少一个硬链接，因为文件名就是一个硬链接**。

但由于硬链接无法直接显示出，具体分辨可以用：`ls -il` 查看文件节点号，节点号对应磁盘上存储数据的位置，最终也可以看出二者是同一个文件。

![](img/24.jpg)

![25](img/25.jpg)

**符号链接**：与 Windows 的快捷方式类似，不过早于快捷方式，用于克服硬链接缺陷。

```bash
ln -s fun fun-soft
ln -s ../fun dir1/fun-soft
#为目录创建
ln -s dir1 dir1-sym
```

![](img/26.jpg)

### 1.4深入理解命令

#### 帮助和识别命令

命令的种类：

- 可执行程序
- 在 Shell 中的内建命令
- Shell 函数
- 别名，自定义命令

#### 详细介绍

**type**

确定命令的类型，需要注意的是，**ls 实际上是添加了 --color=tty 选项命令的别名 (aliased)，所以输出结果是彩色的。**

![](img/27.jpg)

**which**

显示**可执行文件**的位置

**help**

获取帮助文档

```bash
#适用于所有的Shell内建命令
help cd 
mkdir --help
```

**man**

大多数命令行程序会提供一份叫做手册 (manual) 或手册页 (man page) 的正式文档。

一般包含以下的内容：

- 标题
- 命令语法提要
- 命令作用描述
- 命令选项清单及描述

```bash
man ls
man 5 passwd #显示指定的节
man -k list #使用关键字粗糙搜索，与 apropos list 类似
```

![](img/28.jpg)

```bash
whatis ls #显示手册的简介
```

#### alias 创建自己的命令

可以使用分隔符 `;` ，一行输入多个命令。

```bash
type foo # 命名前最好检查下名称是否被占用
alias foo='cd /usr; ls; cd -'
type foo # 命名完使用 type 查看别名
unalias foo # 删除别名

# 列出所有的别名
alias
```

需要注意的是：当 Shell 会话结束时，别名会随着消失，为了避免可添加到**系统环境初始化文件**中。

### 1.3重定向

- cat : 拼接文件
- sort: 排序文本行
- uniq: 报告或忽略重复的行
- wc: 统计文件中换行符，单词以及字节的数量
- grep: 输出与模式匹配的行
- head: 输出文件的开头部分
- tail: 输出结尾部分
- tee: 读取标准输入并将输出结果写入标准输出和文件

#### 标准输入/出

程序可能产生的结果

- 运行的结果
- 运行的状态和错误信息

实际上，程序将结果和状态消息分别发送到了名为：

`stdout` (标准输出，standard ouput) 

`stdeer` (标准错误，standard error) 的特殊文件

默认情况下，标准输出和标准错误与显示器屏幕相关联，**不会保存为磁盘文件。**

`stdin` : 程序从中获取输入信息，**重定向则允许我们修改输出结果的去处和来源**。

#### 输出重定向

将输出重定向到其他文件中，而不是默认的屏幕上，**通常是将命令的输出结果保存到文件中去。**

```bash
# 可截断某个文件或创建一个新文件
> filename.txt

# >> 重定向操作符,文件存在则追加，不存在则新建
ls -l /usr/bin >> file_name.txt
```

#### 标准错误重定向

Shell 内部用文件描述符引用标准输入/出和错误：

- 标准输入：文件描述符— 0
- 标准输出：文件描述符— 1
- 标准错误：文件描述符— 2

```bash
# 使用文件描述符进行重定向写法
ls -l /bin/usr 2> demo.txt # 标准错误重定向
```

**输出和错误在同一文件**

传统方式：

```bash
# 执行两次重定向，标准输出重定向到 demo.txt，再将描述符 2 重定向到描述符1
ls -l /bin/usr > demo.txt 2>&1
```

较新版本的 bash:
```bash
ls -l /bin/usr &> demo.txt
ls -l /bin/usr &>> demo.txt #追加
```

**丢弃不必要的命令**

将输出重定向到 `/dev/null` 的特殊文件，该文件是一个系统设备，通常称为位桶 (bit bucket)。

```bash
ls -l /bin/usr 2> /dev/null
```

#### 标准输入重定向

cat: 用于读取一个或多个文件并将其复制到标准输出，**不分页**显示文件内容，常用于较短的文件。

```bash
cat demo.txt
cat moive.mpeg.0* > movie.mpeg #多个短文件进行合并
```

**输入**

仅用 `cat` 命令，无任何参数，此时等待输入，再按 enter 键，最后按 `ctrl+D` (End Of File，EOF) 结束输入。

```bash
cat > demo.txt # 件输入保存到一个文件中，使用少量文本
cat demo.tx # 查看结果，将 demo.txt 复制到标准输出
cat < input_files.txt #将输入定向到一个文件
```

#### 管道

操作符 `|`，Shell 的管道特性：可以将一个命令的标准输出传给另一个命令的标准输入。

```bash
#将输出结果排序合并并分页显示
ls -l /bin /usr/bin | sort | less
```

报告或忽略重复行—uniq

```bash
# 保证输出结果没有重复行
ls -l /bin /usr/bin | sort | uniq | less
ls -l /bin /usr/bin | sort | uniq -d| less #d选项显示有哪些重复行
```

统计单词，字节和换行符的数量—wc

```bash
#wc (word count) 单词统计
wc demo.txt
ls -l /bin /usr/bin | sort | uniq | wc -l # l选项表示只输出文件行数
```

![](img/33.jpg)

**grep-输出与模式匹配的行**

用于查找文件的的指定文本

grep -i : 命令搜索时忽略大小写

grep -v: 只输出不匹配的行

```bash
# 从程序列表中找出名称中包含单词 zip 的所有文件
ls -l /bin /usr/bin | sort | uniq | grep zip
```

输入开头 head 和结尾 tail (前 10 行和后 10 行)

```bash
head -n 15 demo.txt #n 表示输出15行
ls /usr/bin | tail -n 5

#注意的是tail有一个tail选项可动态查看
tail -f demo.txt
```

tee: 管道中的 T 形头，读取输入并将结果写入到文件。

```bash
ls -l /bin /usr/bin | sort | uniq | |tee demT.txt | grep zip
```





